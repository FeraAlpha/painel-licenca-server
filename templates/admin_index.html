<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8"/>
<title>Fera Alpha — Painel l</title>
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<style>
  :root{
    --bg:#f5f7fa;
    --card:#ffffff;
    --border:#e1e4e8;
    --text:#2c3e50;
    --text-light:#66737f;
    --accent:#276ef1;      /* Azul profissional */
    --danger:#d64545;      /* Vermelho soft */
    --radius:10px;
  }

  *{margin:0;padding:0;box-sizing:border-box;font-family:"Inter",Arial;}

  body{
    background:var(--bg);
    padding:24px;
    color:var(--text);
  }

  h1{font-size:24px;font-weight:700;margin-bottom:4px;}
  .sub{color:var(--text-light);margin-bottom:20px;}

  .card{
    background:var(--card);
    border:1px solid var(--border);
    padding:20px;
    border-radius:var(--radius);
    margin-bottom:20px;
  }

  label{
    font-size:14px;
    color:var(--text-light);
    margin-bottom:4px;
    display:block;
  }

  input{
    width:100%;
    padding:10px;
    border:1px solid var(--border);
    border-radius:6px;
    margin-bottom:12px;
    font-size:14px;
  }

  .btn{
    padding:10px 16px;
    border:none;
    border-radius:6px;
    font-weight:600;
    cursor:pointer;
  }

  .btn-primary{
    background:var(--accent);
    color:white;
  }

  .btn-danger{
    background:var(--danger);
    color:white;
  }

  .header-row{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:14px;
  }

  table{
    width:100%;
    border-collapse:collapse;
    font-size:14px;
  }

  thead th{
    text-align:left;
    padding:10px;
    font-weight:600;
    background:#f0f2f5;
    border-bottom:1px solid var(--border);
    color:var(--text-light);
  }

  tbody td{
    padding:10px;
    border-bottom:1px solid var(--border);
  }

  tbody tr:hover{
    background:#fafafa;
  }

  .badge{
    padding:4px 10px;
    border-radius:20px;
    font-size:12px;
    font-weight:600;
    display:inline-block;
  }

  .badge-ok{
    background:#e6f4ea;
    color:#1b7f3d;
  }

  .badge-warn{
    background:#fff6e5;
    color:#b07d2d;
  }

  .badge-exp{
    background:#fdecea;
    color:#b23a3a;
  }

  .copy{
    color:var(--accent);
    cursor:pointer;
    font-weight:600;
    margin-left:6px;
  }

</style>
</head>

<body>

<h1>Fera Alpha — Painel Profissional</h1>
<div class="sub">Gerenciamento corporativo de Keys e usuários</div>

<!-- Criar Key -->
<div class="card">
  <h2 style="font-size:18px;margin-bottom:10px;">Gerar nova key</h2>

  <form method="post" action="/admin/generate">
    <label>Usuário</label>
    <input type="text" name="username" placeholder="ex: cliente01" required>

    <label>Senha</label>
    <input type="text" name="password" placeholder="senha do cliente" required>

    <label>Prefixo</label>
    <input type="text" name="prefix" value="FERA">

    <label>Expiração (dias)</label>
    <input type="number" name="expire_days" value="30">

    <button class="btn btn-primary">Gerar Key</button>
  </form>
</div>


<!-- Lista -->
<div class="card">
  <div class="header-row">
    <h2 style="font-size:18px">Usuários cadastrados</h2>
  </div>

  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Usuário</th>
        <th>Key</th>
        <th>Device</th>
        <th>Expiração</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {% for u in users %}
      <tr>
        <td>{{ loop.index0 }}</td>
        <td>{{ u.username }}</td>
        <td>
          {{ u.key }}
          <span class="copy" onclick="navigator.clipboard.writeText('{{ u.key }}')">copiar</span>
        </td>
        <td>{{ u.device_id if u.device_id else '-' }}</td>

        <td>
          {% if u.expires_at %}
            {% set now = (datetime.now().timestamp()) %}
            {% set diff = (u.expires_at - now) / 86400 %}

            {% if diff < 0 %}
              <span class="badge badge-exp">Expirado</span>
            {% elif diff < 7 %}
              <span class="badge badge-warn">{{ diff|round }} dias</span>
            {% else %}
              <span class="badge badge-ok">{{ diff|round }} dias</span>
            {% endif %}

          {% else %}
            <span class="badge badge-ok">Ilimitada</span>
          {% endif %}
        </td>

        <td>
          <form method="post" action="/admin/delete/{{ loop.index0 }}">
            <button class="btn btn-danger">Excluir</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

</body>
            </html>
