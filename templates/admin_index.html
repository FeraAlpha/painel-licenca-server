<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8"/>
<title>Fera Alpha — Painel</title>
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<style>
  :root{
    --bg:#bfc3c9; 
    --card:#ffffff;
    --border:#d0d3d6;
    --text:#2b2f33;
    --text-light:#6d7480;
    --accent:#2f6fed;
    --danger:#d93c3c;
    --radius:14px;
  }

  *{margin:0;padding:0;box-sizing:border-box;font-family:"Inter",Arial;}

  body{
    background:var(--bg);
    padding:28px;
    color:var(--text);
  }

  h1{
    font-size:30px;
    font-weight:700;
    margin-bottom:20px;
  }

  h2{
    margin-bottom:16px;
    font-size:20px;
    font-weight:700;
    color:var(--text);
  }

  .card{
    background:var(--card);
    border:1px solid var(--border);
    padding:24px;
    border-radius:var(--radius);
    margin-bottom:28px;
    box-shadow:0 2px 10px rgba(0,0,0,0.12);
  }

  label{
    font-size:14px;
    font-weight:600;
    color:var(--text-light);
    display:block;
    margin-bottom:4px;
  }

  input{
    width:100%;
    padding:12px;
    border:1px solid var(--border);
    border-radius:8px;
    margin-bottom:14px;
    font-size:15px;
    background:white;
    color:var(--text);
  }

  .btn{
    padding:12px 22px;
    border:none;
    border-radius:8px;
    font-weight:700;
    cursor:pointer;
    font-size:15px;
  }

  .btn-primary{background:var(--accent);color:white;}
  .btn-danger{background:var(--danger);color:white;}

  table{
    width:100%;
    border-collapse:collapse;
    font-size:15px;
  }

  thead th{
    text-align:left;
    padding:12px;
    font-weight:700;
    background:#eceff1;
    color:var(--text-light);
    border-bottom:1px solid var(--border);
  }

  tbody td{
    padding:12px;
    border-bottom:1px solid var(--border);
  }

  tbody tr:hover{
    background:#e7e9ec;
  }

  .badge{
    padding:7px 14px;
    border-radius:22px;
    font-size:13px;
    font-weight:700;
    display:inline-block;
  }

  .badge-ok{background:#d5f6db;color:#0d7a2e;}
  .badge-warn{background:#fff1c9;color:#916c18;}
  .badge-exp{background:#ffd5d5;color:#b50f0f;}

  .copy{
    color:var(--accent);
    cursor:pointer;
    font-weight:700;
    margin-left:6px;
  }
</style>
</head>

<body>

<h1>Fera Alpha — Painel</h1>

<!-- Criar Key -->
<div class="card">
  <h2>Gerar nova key</h2>

  <form method="post" action="/admin/generate">
    <label>Usuário</label>
    <input type="text" name="username" placeholder="ex: cliente01" required>

    <label>Senha</label>
    <input type="text" name="password" placeholder="senha do cliente" required>

    <label>Prefixo</label>
    <input type="text" name="prefix" value="FERA">

    <label>Expiração (dias)</label>
    <input type="number" name="expire_days" value="30">

    <button class="btn btn-primary">Gerar Key</button>
  </form>
</div>

<!-- Lista -->
<div class="card">
  <h2>Usuários cadastrados</h2>

  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Usuário</th>
        <th>Key</th>
        <th>Device</th>
        <th>Expiração</th>
        <th>Ação</th>
      </tr>
    </thead>

    <tbody>
      {% for u in users %}
      <tr>
        <td>{{ loop.index0 }}</td>
        <td>{{ u.username }}</td>

        <td>
          {{ u.key }}
          <span class="copy" onclick="navigator.clipboard.writeText('{{ u.key }}')">copiar</span>
        </td>

        <td>{{ u.device_id if u.device_id else '-' }}</td>

        <td>
          {% if u.expires_at %}
            {% set now = (datetime.now().timestamp()) %}
            {% set diff = (u.expires_at - now) / 86400 %}

            {% if diff < 0 %}
              <span class="badge badge-exp">Expirado</span>

            {% elif diff < 3 %}
              <span class="badge badge-exp">Expira em {{ diff|round }} dias</span>

            {% elif diff < 7 %}
              <span class="badge badge-warn">{{ diff|round }} dias</span>

            {% else %}
              <span class="badge badge-ok">{{ diff|round }} dias</span>

            {% endif %}
          {% else %}
            <span class="badge badge-ok">Ilimitada</span>
          {% endif %}
        </td>

        <td>
          <form method="post" action="/admin/delete/{{ loop.index0 }}">
            <button class="btn btn-danger">Excluir</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

</div>

</body>
            </html>
