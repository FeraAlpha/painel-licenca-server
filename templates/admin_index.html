<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8"/>
<title>Fera Alpha ‚Äî Painel Administrativo</title>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
  :root {
    --bg: #f0f2f5;
    --card: #ffffff;
    --border: #d1d9e6;
    --text: #2c3e50;
    --text-light: #7f8c8d;
    --accent: #3498db;
    --accent-dark: #2980b9;
    --danger: #e74c3c;
    --danger-dark: #c0392b;
    --warning: #f39c12;
    --warning-dark: #d68910;
    --success: #27ae60;
    --success-dark: #219653;
    --info: #2f6fed;
    --radius: 12px;
    --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    --shadow-hover: 0 6px 18px rgba(0, 0, 0, 0.12);
    --transition: all 0.3s ease;
  }

  .dark-mode {
    --bg: #0f172a;
    --card: #1e293b;
    --border: #334155;
    --text: #f1f5f9;
    --text-light: #94a3b8;
    --accent: #60a5fa;
    --accent-dark: #3b82f6;
    --danger: #f87171;
    --danger-dark: #dc2626;
    --warning: #fbbf24;
    --warning-dark: #f59e0b;
    --success: #4ade80;
    --success-dark: #22c55e;
    --info: #38bdf8;
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Segoe UI', 'Inter', system-ui, -apple-system, sans-serif;
  }

  body {
    background: var(--bg);
    color: var(--text);
    padding: 20px;
    min-height: 100vh;
    transition: var(--transition);
  }

  header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    padding-bottom: 15px;
    border-bottom: 1px solid var(--border);
  }

  .header-left h1 {
    font-size: 28px;
    font-weight: 800;
    background: linear-gradient(90deg, var(--accent), var(--info));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 5px;
  }

  .header-left .subtitle {
    font-size: 14px;
    color: var(--text-light);
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .header-left .subtitle i {
    color: var(--accent);
  }

  .header-right {
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .stats {
    display: flex;
    gap: 15px;
    margin-bottom: 25px;
    flex-wrap: wrap;
  }

  .stat-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 20px;
    flex: 1;
    min-width: 180px;
    box-shadow: var(--shadow);
    transition: var(--transition);
  }

  .stat-card:hover {
    box-shadow: var(--shadow-hover);
    transform: translateY(-2px);
  }

  .stat-card i {
    font-size: 24px;
    margin-bottom: 12px;
    border-radius: 10px;
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .stat-card.total i { background: rgba(52, 152, 219, 0.15); color: var(--accent); }
  .stat-card.active i { background: rgba(39, 174, 96, 0.15); color: var(--success); }
  .stat-card.expired i { background: rgba(231, 76, 60, 0.15); color: var(--danger); }
  .stat-card.unlimited i { background: rgba(47, 111, 237, 0.15); color: var(--info); }

  .stat-card h3 {
    font-size: 32px;
    font-weight: 800;
    margin-bottom: 5px;
  }

  .stat-card p {
    font-size: 14px;
    color: var(--text-light);
  }

  .card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 25px;
    margin-bottom: 25px;
    box-shadow: var(--shadow);
    transition: var(--transition);
  }

  .card:hover {
    box-shadow: var(--shadow-hover);
  }

  .card h2 {
    font-size: 20px;
    font-weight: 700;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .card h2 i {
    color: var(--accent);
  }

  label {
    font-weight: 600;
    display: block;
    margin-bottom: 8px;
    color: var(--text);
  }

  .form-group {
    margin-bottom: 20px;
  }

  input, select {
    width: 100%;
    padding: 14px;
    border-radius: 10px;
    border: 1px solid var(--border);
    background: var(--card);
    color: var(--text);
    font-size: 15px;
    transition: var(--transition);
  }

  input:focus, select:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
  }

  input::placeholder {
    color: var(--text-light);
    opacity: 0.7;
  }

  .btn {
    padding: 12px 24px;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 700;
    border: none;
    font-size: 15px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: var(--transition);
  }

  .btn i {
    font-size: 16px;
  }

  .btn-primary { 
    background: var(--accent); 
    color: white; 
  }
  .btn-primary:hover { 
    background: var(--accent-dark); 
    transform: translateY(-2px);
  }

  .btn-danger  { 
    background: var(--danger); 
    color: white; 
  }
  .btn-danger:hover { 
    background: var(--danger-dark); 
    transform: translateY(-2px);
  }

  .btn-ghost   { 
    background: transparent; 
    border: 1px solid var(--border); 
    color: var(--text); 
  }
  .btn-ghost:hover { 
    background: var(--bg);
    border-color: var(--accent);
  }

  .btn-warning { 
    background: var(--warning); 
    color: white; 
  }
  .btn-warning:hover { 
    background: var(--warning-dark);
    transform: translateY(-2px);
  }

  .btn-success { 
    background: var(--success); 
    color: white; 
  }
  .btn-success:hover { 
    background: var(--success-dark);
    transform: translateY(-2px);
  }

  .btn-group {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    margin-top: 20px;
  }

  .admin-tools {
    display: flex;
    gap: 15px;
    margin-bottom: 25px;
    flex-wrap: wrap;
  }
  
  .admin-tools form {
    display: inline-block;
  }

  .search-container {
    position: relative;
    margin-bottom: 20px;
  }

  .search-container i {
    position: absolute;
    left: 18px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-light);
    z-index: 2;
  }

  .search-container input {
    padding-left: 50px;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
  }

  thead {
    background: var(--card);
    border-bottom: 2px solid var(--border);
  }

  thead th {
    padding: 18px 15px;
    text-align: left;
    font-weight: 700;
    color: var(--text);
    cursor: pointer;
    user-select: none;
    transition: var(--transition);
    white-space: nowrap;
  }

  thead th:hover {
    background: var(--bg);
  }

  thead th i {
    margin-left: 5px;
    opacity: 0.6;
    font-size: 12px;
  }

  tbody tr {
    border-bottom: 1px solid var(--border);
    transition: var(--transition);
  }

  tbody tr:hover {
    background: var(--bg);
  }

  tbody td {
    padding: 18px 15px;
    word-break: break-word;
  }

  .copy {
    color: var(--accent);
    cursor: pointer;
    font-weight: 700;
    margin-left: 8px;
    transition: var(--transition);
    display: inline-flex;
    align-items: center;
    gap: 4px;
  }

  .copy:hover {
    color: var(--accent-dark);
    transform: scale(1.05);
  }

  .badge {
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 700;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    white-space: nowrap;
  }

  .badge i {
    font-size: 12px;
  }

  .badge-ok { 
    background: rgba(39, 174, 96, 0.15); 
    color: var(--success); 
  }
  .badge-warn { 
    background: rgba(243, 156, 18, 0.15); 
    color: var(--warning); 
  }
  .badge-exp { 
    background: rgba(231, 76, 60, 0.15); 
    color: var(--danger); 
  }
  .badge-unl { 
    background: rgba(47, 111, 237, 0.15); 
    color: var(--info); 
  }

  .actions-cell {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }

  .actions-cell form {
    display: inline-block;
  }

  .actions-cell button {
    min-width: 40px;
    padding: 8px 12px;
  }

  .small-input {
    width: 80px;
    padding: 8px 10px;
    text-align: center;
  }

  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    z-index: 1000;
    align-items: center;
    justify-content: center;
  }

  .modal-content {
    background: var(--card);
    border-radius: var(--radius);
    padding: 30px;
    width: 90%;
    max-width: 500px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
  }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }

  .modal-header h3 {
    font-size: 20px;
    font-weight: 700;
  }

  .close-modal {
    background: transparent;
    border: none;
    font-size: 24px;
    color: var(--text-light);
    cursor: pointer;
    transition: var(--transition);
  }

  .close-modal:hover {
    color: var(--danger);
  }

  .modal-footer {
    display: flex;
    justify-content: flex-end;
    gap: 15px;
    margin-top: 25px;
  }

  .toast {
    position: fixed;
    bottom: 30px;
    right: 30px;
    padding: 15px 25px;
    border-radius: 10px;
    background: var(--success);
    color: white;
    font-weight: 600;
    box-shadow: var(--shadow-hover);
    display: none;
    align-items: center;
    gap: 10px;
    z-index: 1001;
    animation: slideIn 0.3s ease;
  }

  @keyframes slideIn {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }

  @media (max-width: 768px) {
    body {
      padding: 15px;
    }
    
    .header-left h1 {
      font-size: 24px;
    }
    
    .stats {
      flex-direction: column;
    }
    
    .stat-card {
      min-width: 100%;
    }
    
    thead th, tbody td {
      padding: 12px 8px;
    }
    
    .actions-cell {
      flex-direction: column;
    }
    
    .actions-cell form {
      width: 100%;
    }
    
    .actions-cell button {
      width: 100%;
      justify-content: center;
    }
    
    .btn-group {
      flex-direction: column;
    }
    
    .btn-group button {
      width: 100%;
    }
  }
</style>
</head>

<body>

<header>
  <div class="header-left">
    <h1><i class="fas fa-shield-alt"></i> Fera Alpha ‚Äî Admin</h1>
    <div class="subtitle">
      <i class="fas fa-cogs"></i>
      <span>Painel de gerenciamento avan√ßado</span>
    </div>
  </div>

  <div class="header-right">
    <div class="user-info">
      <span id="currentTime">--:--:--</span>
    </div>
    <button class="btn btn-ghost" onclick="toggleDark()">
      <i class="fas fa-moon"></i>
      <span>Tema</span>
    </button>
  </div>
</header>

<!-- ESTAT√çSTICAS -->
<div class="stats">
  <div class="stat-card total">
    <i class="fas fa-users"></i>
    <h3 id="totalUsers">0</h3>
    <p>Total de Usu√°rios</p>
  </div>
  
  <div class="stat-card active">
    <i class="fas fa-check-circle"></i>
    <h3 id="activeUsers">0</h3>
    <p>Licen√ßas Ativas</p>
  </div>
  
  <div class="stat-card expired">
    <i class="fas fa-exclamation-circle"></i>
    <h3 id="expiredUsers">0</h3>
    <p>Licen√ßas Expiradas</p>
  </div>
  
  <div class="stat-card unlimited">
    <i class="fas fa-infinity"></i>
    <h3 id="unlimitedUsers">0</h3>
    <p>Licen√ßas Ilimitadas</p>
  </div>
</div>

<!-- ADMIN TOOLS -->
<div class="admin-tools">
  <form method="post" action="/admin/reset_all_devices" 
        onsubmit="return confirmAction('‚ö†Ô∏è Resetar TODOS os devices? Esta a√ß√£o n√£o pode ser desfeita.')">
    <button type="submit" class="btn btn-warning">
      <i class="fas fa-redo-alt"></i>
      Resetar Todos Devices
    </button>
  </form>
  
  <form method="post" action="/admin/clean_expired" 
        onsubmit="return confirmAction('üóëÔ∏è Remover TODOS os usu√°rios expirados?')">
    <button type="submit" class="btn btn-danger">
      <i class="fas fa-trash-alt"></i>
      Limpar Expirados
    </button>
  </form>
  
  <button class="btn btn-success" onclick="showGenerateModal()">
    <i class="fas fa-key"></i>
    Nova Licen√ßa
  </button>
</div>

<!-- TABELA DE USU√ÅRIOS -->
<div class="card">
  <h2><i class="fas fa-list"></i> Gerenciamento de Licen√ßas</h2>
  
  <div class="search-container">
    <i class="fas fa-search"></i>
    <input id="searchUser" placeholder="Buscar por usu√°rio, key, device...">
  </div>

  <div style="overflow-x: auto;">
    <table id="usersTable">
      <thead>
        <tr>
          <th onclick="sortTable(0)">
            <span>ID</span>
            <i class="fas fa-sort"></i>
          </th>
          <th onclick="sortTable(1)">
            <span>Usu√°rio</span>
            <i class="fas fa-sort"></i>
          </th>
          <th>Senha</th>
          <th>Licen√ßa</th>
          <th>Device</th>
          <th onclick="sortTable(5)">
            <span>Status</span>
            <i class="fas fa-sort"></i>
          </th>
          <th>A√ß√µes</th>
        </tr>
      </thead>

      <tbody>
        {% for u in users %}
        <tr data-expires="{{ u.expires_at }}" data-key="{{ u.key }}" data-username="{{ u.username }}" data-password="{{ u.password }}">
          <td><strong>#{{ loop.index0 + 1 }}</strong></td>
          <td>
            <strong>{{ u.username }}</strong>
          </td>
          <td>
            <code>{{ u.password }}</code>
            <span class="copy" onclick="copyCredentials('{{ u.username }}', '{{ u.password }}')">
              <i class="fas fa-copy"></i>
              Copiar
            </span>
          </td>
          <td>
            <code style="font-family: monospace; font-size: 13px;">{{ u.key }}</code>
            <span class="copy" onclick="copyKey('{{ u.key }}', this)">
              <i class="fas fa-copy"></i>
              Copiar
            </span>
          </td>
          <td>
            {% if u.device_id %}
              <span class="badge badge-ok">
                <i class="fas fa-desktop"></i>
                {{ u.device_id|truncate(10) }}
              </span>
            {% else %}
              <span class="badge badge-warn">
                <i class="fas fa-times"></i>
                N√£o vinculado
              </span>
            {% endif %}
          </td>
          <td class="expCell"></td>
          <td class="actions-cell">
            <form method="post" action="/admin/renew/{{ loop.index0 }}" onsubmit="return confirmAction('Adicionar 30 dias √† licen√ßa?')">
              <button type="submit" class="btn btn-success" title="+30 Dias">
                <i class="fas fa-calendar-plus"></i>
              </button>
            </form>

            <form method="post" action="/admin/renew_custom/{{ loop.index0 }}" onsubmit="return confirmAction('Adicionar dias √† licen√ßa?')" style="display: flex; gap: 5px;">
              <input type="number" name="days" min="1" value="7" class="small-input">
              <button type="submit" class="btn btn-primary" title="+ Dias">
                <i class="fas fa-plus"></i>
              </button>
            </form>

            <form method="post" action="/admin/make_unlimited/{{ loop.index0 }}" onsubmit="return confirmAction('Tornar esta licen√ßa ilimitada?')">
              <button type="submit" class="btn btn-ghost" title="Ilimitado">
                <i class="fas fa-infinity"></i>
              </button>
            </form>

            <form method="post" action="/admin/reset/{{ loop.index0 }}" onsubmit="return confirmAction('Resetar esta key?')">
              <button type="submit" class="btn btn-ghost" title="Resetar Key">
                <i class="fas fa-key"></i>
              </button>
            </form>

            <form method="post" action="/admin/reset_device/{{ loop.index0 }}" onsubmit="return confirmAction('Resetar device vinculado?')">
              <button type="submit" class="btn btn-warning" title="Reset Device">
                <i class="fas fa-desktop"></i>
              </button>
            </form>

            <form method="post" action="/admin/delete/{{ loop.index0 }}" onsubmit="return confirmAction('Excluir usu√°rio permanentemente?')">
              <button type="submit" class="btn btn-danger" title="Excluir">
                <i class="fas fa-trash"></i>
              </button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- MODAL GERAR NOVA LICEN√áA -->
<div id="generateModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3><i class="fas fa-key"></i> Gerar Nova Licen√ßa</h3>
      <button class="close-modal" onclick="hideGenerateModal()">&times;</button>
    </div>
    
    <form method="post" action="/admin/generate" id="generateForm">
      <div class="form-group">
        <label><i class="fas fa-user"></i> Usu√°rio</label>
        <input name="username" required placeholder="Digite o nome de usu√°rio">
      </div>
      
      <div class="form-group">
        <label><i class="fas fa-lock"></i> Senha</label>
        <input name="password" required placeholder="Digite a senha">
      </div>
      
      <div class="form-group">
        <label><i class="fas fa-tag"></i> Prefixo da Licen√ßa</label>
        <input name="prefix" value="FERA" placeholder="Ex: FERA, ALPHA, etc">
      </div>
      
      <div class="form-group">
        <label><i class="fas fa-calendar-alt"></i> Expira√ß√£o</label>
        <select name="expire_days" id="expireSelect">
          <option value="7">7 Dias</option>
          <option value="30" selected>30 Dias</option>
          <option value="90">90 Dias</option>
          <option value="180">180 Dias</option>
          <option value="365">1 Ano</option>
          <option value="0">Ilimitado</option>
        </select>
      </div>
      
      <div class="modal-footer">
        <button type="button" class="btn btn-ghost" onclick="hideGenerateModal()">
          Cancelar
        </button>
        <button type="submit" class="btn btn-primary">
          <i class="fas fa-check"></i>
          Gerar Licen√ßa
        </button>
      </div>
    </form>
  </div>
</div>

<!-- TOAST NOTIFICATION -->
<div id="toast" class="toast">
  <i class="fas fa-check-circle"></i>
  <span id="toastMessage">Copiado para a √°rea de transfer√™ncia!</span>
</div>

<script>
// ====================
// VARI√ÅVEIS GLOBAIS
// ====================
let sortDirection = {};

// ====================
// FUN√á√ïES DE UTILIDADE
// ====================
function toggleDark() {
  document.body.classList.toggle('dark-mode');
  localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
}

function showToast(message, type = 'success') {
  const toast = document.getElementById('toast');
  const toastMessage = document.getElementById('toastMessage');
  
  toast.style.background = type === 'success' ? 'var(--success)' : 
                          type === 'error' ? 'var(--danger)' : 'var(--warning)';
  
  toastMessage.textContent = message;
  toast.style.display = 'flex';
  
  setTimeout(() => {
    toast.style.display = 'none';
  }, 3000);
}

function confirmAction(message) {
  return confirm(`‚ùì ${message}`);
}

// ====================
// FUN√á√ïES DE C√ìPIA
// ====================
function copyKey(key, element) {
  navigator.clipboard.writeText(key);
  showToast('Licen√ßa copiada para a √°rea de transfer√™ncia!');
  
  // Feedback visual no bot√£o
  const icon = element.querySelector('i');
  const originalIcon = icon.className;
  const originalText = element.innerHTML;
  
  icon.className = 'fas fa-check';
  element.innerHTML = element.innerHTML.replace('Copiar', 'Copiado!');
  
  setTimeout(() => {
    icon.className = originalIcon;
    element.innerHTML = originalText;
  }, 1500);
}

function copyCredentials(username, password) {
  const text = `üë§ Usu√°rio: ${username}\nüîí Senha: ${password}`;
  navigator.clipboard.writeText(text);
  showToast('Credenciais copiadas para a √°rea de transfer√™ncia!');
}

// ====================
// FUN√á√ïES DE MODAL
// ====================
function showGenerateModal() {
  document.getElementById('generateModal').style.display = 'flex';
}

function hideGenerateModal() {
  document.getElementById('generateModal').style.display = 'none';
}

// Fechar modal ao clicar fora
window.onclick = function(event) {
  const modal = document.getElementById('generateModal');
  if (event.target === modal) {
    hideGenerateModal();
  }
};

// ====================
// FUN√á√ïES DE BUSCA E ORDENA√á√ÉO
// ====================
document.getElementById('searchUser').addEventListener('input', function() {
  const query = this.value.toLowerCase();
  const rows = document.querySelectorAll('#usersTable tbody tr');
  
  rows.forEach(row => {
    const text = row.textContent.toLowerCase();
    row.style.display = text.includes(query) ? '' : 'none';
  });
  
  updateStats();
});

function sortTable(columnIndex) {
  const table = document.getElementById('usersTable');
  const tbody = table.querySelector('tbody');
  const rows = Array.from(tbody.querySelectorAll('tr'));
  
  // Determinar dire√ß√£o da ordena√ß√£o
  if (!sortDirection[columnIndex]) sortDirection[columnIndex] = 'asc';
  const direction = sortDirection[columnIndex];
  
  // Atualizar √≠cones
  table.querySelectorAll('th i').forEach(icon => {
    icon.className = 'fas fa-sort';
  });
  
  const currentIcon = table.querySelectorAll('th')[columnIndex].querySelector('i');
  currentIcon.className = direction === 'asc' ? 'fas fa-sort-up' : 'fas fa-sort-down';
  
  // Ordenar linhas
  rows.sort((a, b) => {
    let aValue = a.cells[columnIndex].textContent.trim();
    let bValue = b.cells[columnIndex].textContent.trim();
    
    // Tratamento especial para colunas num√©ricas (ID)
    if (columnIndex === 0) {
      aValue = parseInt(aValue.replace('#', ''));
      bValue = parseInt(bValue.replace('#', ''));
    }
    
    // Tratamento especial para coluna de status
    if (columnIndex === 5) {
      const aExp = parseInt(a.getAttribute('data-expires'));
      const bExp = parseInt(b.getAttribute('data-expires'));
      aValue = aExp || 0;
      bValue = bExp || 0;
    }
    
    if (direction === 'asc') {
      return aValue > bValue ? 1 : -1;
    } else {
      return aValue < bValue ? 1 : -1;
    }
  });
  
  // Reinserir linhas ordenadas
  rows.forEach(row => tbody.appendChild(row));
  
  // Alternar dire√ß√£o para pr√≥xima ordena√ß√£o
  sortDirection[columnIndex] = direction === 'asc' ? 'desc' : 'asc';
}

// ====================
// FUN√á√ïES DE STATUS E ESTAT√çSTICAS
// ====================
function updateExpirationBadges() {
  const now = Math.floor(Date.now() / 1000);
  let total = 0, active = 0, expired = 0, unlimited = 0;
  
  document.querySelectorAll('tr[data-expires]').forEach(row => {
    const expires = parseInt(row.getAttribute('data-expires'));
    const cell = row.querySelector('.expCell');
    
    total++;
    
    if (!expires || expires === 0 || expires >= 9999999999) {
      cell.innerHTML = '<span class="badge badge-unl"><i class="fas fa-infinity"></i> Ilimitado</span>';
      unlimited++;
      return;
    }
    
    const diffDays = Math.floor((expires - now) / 86400);
    
    if (expires < now) {
      cell.innerHTML = `<span class="badge badge-exp"><i class="fas fa-exclamation-circle"></i> Expirado</span>`;
      expired++;
    } else if (diffDays < 3) {
      cell.innerHTML = `<span class="badge badge-exp"><i class="fas fa-hourglass-end"></i> ${diffDays} dias</span>`;
      active++;
    } else if (diffDays < 7) {
      cell.innerHTML = `<span class="badge badge-warn"><i class="fas fa-exclamation-triangle"></i> ${diffDays} dias</span>`;
      active++;
    } else {
      cell.innerHTML = `<span class="badge badge-ok"><i class="fas fa-check-circle"></i> ${diffDays} dias</span>`;
      active++;
    }
  });
  
  // Atualizar estat√≠sticas
  document.getElementById('totalUsers').textContent = total;
  document.getElementById('activeUsers').textContent = active;
  document.getElementById('expiredUsers').textContent = expired;
  document.getElementById('unlimitedUsers').textContent = unlimited;
}

// ====================
// FUN√á√ïES DE TEMPO E ATUALIZA√á√ÉO
// ====================
function updateClock() {
  const now = new Date();
  const timeString = now.toLocaleTimeString('pt-BR', { 
    hour12: false,
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit'
  });
  document.getElementById('currentTime').textContent = timeString;
}

// ====================
// INICIALIZA√á√ÉO
// ====================
document.addEventListener('DOMContentLoaded', function() {
  // Verificar tema salvo
  if (localStorage.getItem('darkMode') === 'true') {
    document.body.classList.add('dark-mode');
  }
  
  // Inicializar rel√≥gio
  updateClock();
  setInterval(updateClock, 1000);
  
  // Inicializar badges e estat√≠sticas
  updateExpirationBadges();
  
  // Atualizar estat√≠sticas a cada 30 segundos
  setInterval(updateExpirationBadges, 30000);
  
  // Atualizar estat√≠sticas quando houver busca
  document.getElementById('searchUser').addEventListener('input', updateExpirationBadges);
});

// ====================
// EXPORT/IMPORT (EXTRA)
// ====================
function exportUsers() {
  const users = [];
  document.querySelectorAll('tr[data-key]').forEach(row => {
    users.push({
      username: row.getAttribute('data-username'),
      password: row.getAttribute('data-password'),
      key: row.getAttribute('data-key'),
      expires: row.getAttribute('data-expires')
    });
  });
  
  const dataStr = JSON.stringify(users, null, 2);
  const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
  
  const exportFileDefaultName = 'fera_alpha_users.json';
  
  const linkElement = document.createElement('a');
  linkElement.setAttribute('href', dataUri);
  linkElement.setAttribute('download', exportFileDefaultName);
  linkElement.click();
  
  showToast('Dados exportados com sucesso!');
}
</script>

</body>
</html>
